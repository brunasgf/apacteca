<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta name="description" content="Miminium Admin Template v.1">
  <meta name="author" content="Isna Nur Azis">
  <meta name="keyword" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Biblioteca e DVDteca</title>

  <!-- start: Css -->
  <link rel="stylesheet" type="text/css" href="asset/css/bootstrap.min.css">

  <!-- plugins -->
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/simple-line-icons.css" />
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/animate.min.css" />
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/fullcalendar.min.css" />
  <link href="asset/css/style.css" rel="stylesheet">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>









  <!-- end: Css -->

  <link rel="shortcut icon" href="asset/img/logomi.png">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="mimin" class="dashboard">
  <!-- start: Header -->
  <nav class="navbar navbar-default header navbar-fixed-top">
    <div class="col-md-12 nav-wrapper">
      <div class="navbar-header" style="width:100%;">
        <div class="opener-left-menu is-open">
          <span class="top"></span>
          <span class="middle"></span>
          <span class="bottom"></span>
        </div>
        <a href="index.html" class="navbar-brand">
          <b>APAC</b>
        </a>
      </div>
    </div>
  </nav>
  <!-- end: Header -->

  <div class="container-fluid mimin-wrapper">

    <!-- start:Left Menu -->
    <div id="left-menu">
      <div class="sub-left-menu scroll">
        <ul class="nav nav-list">
          <li>
            <div class="left-bg"></div>
          </li>
          <li class="ripple">
            <a class="tree-toggle nav-header" href="historico.html">
              <span class="fa fa-exchange"></span> Empréstimo
            </a>
          </li>
          <li class="ripple">
            <a class="tree-toggle nav-header" href="index.html">
              <span class="fa fa-book"></span> Acervo </a>
          </li>
          <li class="ripple">
            <li class=" ripple">
              <a class="tree-toggle nav-header" href="pessoas.html">
                <span class="fa-user fa"></span> Pessoas
              </a>
            </li>
        </ul>
      </div>
    </div>
    <!-- end: Left Menu -->






    <!-- start: Content -->
    <div id="content">
      <div class="col-md-12 top-20 padding-0">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-heading">
              <h3>Acervo de Livros e DVD</h3>
            </div>
            <div class="panel-body">
              <div class="responsive-table">
                <div class="text-right">
                  <input type="button" data-toggle="modal" data-target="#modalAdicionar" class=" btn btn-round btn-success" value="Adicionar obra"
                  />
                </div>
                <table class="table" id='myTable'>
                  <thead>
                    <tr>
                      <th>
                        #
                      </th>
                      <th>
                        Título da obra
                      </th>
                      <th>
                        Autor/Diretor
                      </th>
                      <th>
                        Visualizar
                      </th>
                      <th>
                        Editar
                      </th>
                      <th>
                        Excluir
                      </th>
                    </tr>
                    <tbody id="lista">
                      <tr>
                        <td>1</td>
                        <td>O morro dos ventos uivantes</td>
                        <td>não lembro</td>
                        <td>
                          <i class="fa fa-eye" data-toggle="modal" data-target="#modalVisualizar"></i>
                        </td>
                        <td>
                          <i class="fa fa-edit" data-toggle="modal" data-target="#modalEditar"></i>
                        </td>
                        <td>
                          <i class="fa fa-trash" data-toggle="modal" data-target="#modalExcluir"></i>
                        </td>
                      </tr>
                  </thead>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end: content -->


    <!-- modal visualizar -->

    <div class="modal fade" id="modalVisualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Visualizar Obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal" role="form">
                  <fieldset>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Título</label>
                      <div class="col-sm-10">
                        <input type="text" id="tituloView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Tipo</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="tipoView">
                          <option>Livro</option>
                          <option>DVD</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Autor/Diretor</label>
                      <div class="col-sm-10">
                        <input type="text" id="autorView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Gênero</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="generoView">
                          <option>Educativo</option>
                          <option>Informática</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">N° de Exemplares</label>
                      <div class="col-sm-10">
                        <input type="number" id="quantidadeView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Status</label>
                      <div class="col-sm-10">
                        <input type="text" id="statusView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Descrição</label>
                      <div class="col-sm-10">
                        <input type="text" id="descricaoView" class="form-control">
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-round btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- fim modal visualizar -->


    <!-- modal editar -->

    <div class="modal fade" id="modalEditar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Visualizar Obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal" role="form">
                  <fieldset>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Título</label>
                      <div class="col-sm-10">
                        <input type="text" id="tituloEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Tipo</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="tipoEd">
                          <option>Livro</option>
                          <option>DVD</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Autor/Diretor</label>
                      <div class="col-sm-10">
                        <input type="text" id="autorEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Gênero</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="generoEd">
                          <option>Educativo</option>
                          <option>Informática</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">N° de Exemplares</label>
                      <div class="col-sm-10">
                        <input type="text" id="quantidadeEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Status</label>
                      <div class="col-sm-10">
                        <input type="number" id="status" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Descrição</label>
                      <div class="col-sm-10">
                        <input type="text" id="descricaoEd" class="form-control">
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="botaoedit" class="btn btn-round btn-success" data-dismiss="modal">Salvar alterações</button>
            <button type="button" class="btn btn-round btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- fim modal editar -->


    <!-- inicio modal excluir -->

    <div class="modal fade" id="modalExcluir" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Excluir obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Você realmente deseja excluir essa obra? Todos os exemplares serão excluídos também </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-round btn-danger">Excluir</button>
            <button type="button" class="btn btn-round btn-secondary" data-dismiss="modal">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- fim modal excluir -->

    <!-- inicio modal adicionar -->

    <div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Cadastrar Obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal" role="form">
                  <fieldset>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Título</label>
                      <div class="col-sm-10">
                        <input type="text" id="titulo" placeholder="Título da obra " class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Tipo</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="tipo">
                          <option>Livro</option>
                          <option>DVD</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Auto/Diretor</label>
                      <div class="col-sm-10">
                        <input type="text" id="autor" placeholder="Autor(es) ou Diretor(es)" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Gênero</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="genero">
                          <option>Educativo</option>
                          <option>Informática</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">N° de Exemplares</label>
                      <div class="col-sm-10">
                        <input type="number" id="qtd" placeholder="Quantidade de Exemplares" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Status</label>
                      <div class="col-sm-10">
                        <input type="text" id="status" placeholder="Status atual da obra" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Descrição</label>
                      <div class="col-sm-10">
                        <input type="text" id="descricao" placeholder="Descrição e/ou resumo" class="form-control">
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-round btn-success" data-dismiss="modal" onclick="create()">Adicionar obra</button>
            <button type="button" class="btn btn-round btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>



    <!-- fim modal adicionar -->




    <!-- start: Javascript -->
    <script src="asset/js/jquery.min.js"></script>
    <script src="asset/js/jquery.ui.min.js"></script>
    <script src="asset/js/bootstrap.min.js"></script>



    <!-- plugins -->
    <script src="asset/js/plugins/moment.min.js"></script>
    <script src="asset/js/plugins/jquery.datatables.min.js"></script>
    <script src="asset/js/plugins/datatables.bootstrap.min.js"></script>
    <script src="asset/js/plugins/jquery.nicescroll.js"></script>


    <!-- custom -->
    <script src="asset/js/main.js"></script>
    <script type="text/javascript"> 
      $(document).ready(function () {
        $('#myTable').DataTable({
          "oLanguage": {
            "sProcessing": "Processando...",
            "sLengthMenu": "Mostrar _MENU_ registros",
            "sZeroRecords": "Não foram encontrados resultados",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando de 0 até 0 de 0 registros",
            "sInfoFiltered": "",
            "sInfoPostFix": "",
            "sSearch": "Pesquisar:  ",
            "sUrl": "",
            "oPaginate": {
              "sFirst": "Primeiro",
              "sPrevious": "Anterior",
              "sNext": "Seguinte",
              "sLast": "Último"
            }
          }
        })
      });

    </script>

    <script>

      window.onload = () => {
        lista.addEventListener('click', del);
        lista.addEventListener('click', edit);
        lista.addEventListener('click', view)
        read();

      };

      function templateLista(id, titulo, autor, element = true) {
        return `
              ${element ? `<tr>` : ''}
              <td>${id}</td>
              <td>${titulo}</td>
              <td>${autor}</td>
              <td><i class="view fa fa-eye" data-toggle="modal" data-target="#modalVisualizar" data-id=${id}></i></td>
              <td><i class="update fa fa-edit" data-toggle="modal" data-target="#modalEditar" data-id=${id}></i></td>
              <td><i class="delete fa fa-trash " data-toggle="modal" data-id=${id}></i></td>
              ${element ? `</tr>` : ''}
        `;

      }

      function read() {
        lista.innerHTML = '';
        //chamada ajax para o servidor na rota /read
        axios.post('http://localhost:8001/job/getAll')
          .then((response) => {
            console.log(response);
            response.data.data.forEach(element => {
              lista.innerHTML += templateLista(element.id_Obra, element.titulo, element.autor, element.descricao);
            });
          })
          .catch((error) => {
            console.log(error);
          });
      }

      function create() {
        //  const name = texto.value;
        var tipo;
        if (document.getElementById('tipo').value == 'Livro') {
          tipo = 1;
        } else {
          tipo = 2;
        }
        axios.post('http://localhost:8001/job', { qtd: qtd.value, titulo: titulo.value, idGenero: '1', idTipo: tipo, autor: autor.value, descricao: descricao.value })
          .then(function (response) {
            console.log(response);
            // lista.innerHTML += templateLista(response.data[0], titulo.value, autor.value);
            read();
          })
          .catch(function (error) {
            console.log(error);
          });
      }


      function del(element) {
        console.log(element);
        if (element.target.classList.contains('delete')) {
          // id do elemento a excluir?
          const id = element.target.dataset.id;
          axios.delete(`http://localhost:8001/job/${id}`)
            .then(function (response) {
              if (response.status = 200) {
                read();
              }
            })
            .catch(function (error) {
              console.log(error);
            });
        }
      }

      function edit(element) {
        //  console.log();
        const id = element.target.dataset.id;
        // const titulo, autor, descricao, tipo, genero, qtd;
        // console.log(id);
        axios.get(`http://localhost:8001/job/${id}`)
          .then((response) => {
            console.log(response);
            response.data.data.forEach(element => {

              tituloEd.value = element.titulo;
              tipoSelected(element.tipo, 'tipoEd');
              autorEd.value = element.autor;
              quantidadeEd.value = element.qtd;
              descricaoEd.value = element.descricao;

              document.getElementById("botaoedit").addEventListener('click', update(id, element.qtd, element.titulo, element.autor, element.descricao, element.tipo));

            });
          })
          .catch((error) => {
            console.log(error);
          });
      }

      function update(id, qtd, titulo, autor, descricao, tipo) {


        if (tipo == 'Livro') {
          tipo = 1;
        } else {
          tipo = 2;
        }

        axios.put(`http://localhost:8001/job/${id}`, { qtd: qtd, titulo: titulo, idGenero: '1', idStatus: '1', idTipo: tipo, autor: autor, descricao: descricao })
          .then((response) => {
            if (response.status = 200) {
              read();
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function view(element) {
        //  console.log();
        const id = element.target.dataset.id;
        // const titulo, autor, descricao, tipo, genero, qtd;
        // console.log(id);
        axios.get(`http://localhost:8001/job/${id}`)
          .then((response) => {
            console.log(response);
            response.data.data.forEach(element => {

              tituloView.value = element.titulo;
              tipoSelected(element.tipo, 'tipoView');
              autorView.value = element.autor;
              quantidadeView.value = element.qtd;
              descricaoView.value = element.descricao;
            });
          })
          .catch((error) => {
            console.log(error);
          });

      }

      function tipoSelected(tipo, id) {
        document.getElementById(id).innerHTML = '';
        if (tipo == 'Livro') {
          document.getElementById(id).innerHTML +=
            `<option selected>Livro</option>
                <option>DVD</option>`
        } else {
          document.getElementById(id).innerHTML +=
            `<option>Livro</option>
                <option selected>DVD</option>`
        }
      }



    </script>


    <!-- end: Javascript -->
</body>

</html>