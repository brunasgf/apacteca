<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta name="description" content="Miminium Admin Template v.1">
  <meta name="author" content="Isna Nur Azis">
  <meta name="keyword" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Biblioteca e DVDteca</title>

  <!-- start: Css -->
  <link rel="stylesheet" type="text/css" href="asset/css/bootstrap.min.css">

  <!-- plugins -->
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/font-awesome.min.css" />
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/simple-line-icons.css" />
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/animate.min.css" />
  <link rel="stylesheet" type="text/css" href="asset/css/plugins/fullcalendar.min.css" />
  <link href="asset/css/style.css" rel="stylesheet">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>









  <!-- end: Css -->

  <link rel="shortcut icon" href="asset/img/logomi.png">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="mimin" class="dashboard">
  <!-- start: Header -->
  <nav class="navbar navbar-default header navbar-fixed-top">
    <div class="col-md-12 nav-wrapper">
      <div class="navbar-header" style="width:100%;">
        <div class="opener-left-menu is-open">
          <span class="top"></span>
          <span class="middle"></span>
          <span class="bottom"></span>
        </div>
        <a href="index.html" class="navbar-brand">
          <b>APAC</b>
        </a>
      </div>
    </div>
  </nav>
  <!-- end: Header -->

  <div class="container-fluid mimin-wrapper">

    <!-- start:Left Menu -->
    <div id="left-menu">
      <div class="sub-left-menu scroll">
        <ul class="nav nav-list">
          <li>
            <div class="left-bg"></div>
          </li>
          <li class="ripple">
            <a class="tree-toggle nav-header" href="historico.html">
              <span class="fa fa-exchange"></span> Empréstimo
            </a>
          </li>
          <li class="ripple">
            <a class="tree-toggle nav-header" href="index.html">
              <span class="fa fa-book"></span> Acervo </a>
          </li>
          <li class="ripple">
            <li class=" ripple">
              <a class="tree-toggle nav-header" href="pessoas.html">
                <span class="fa-user fa"></span> Pessoas
              </a>
            </li>
        </ul>
      </div>
    </div>
    <!-- end: Left Menu -->






    <!-- start: Content -->
    <div id="content">
      <div class="col-md-12 top-20 padding-0">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-heading">
              <h3>Acervo de Livros e DVD</h3>
            </div>
            <div class="panel-body">
              <div class="responsive-table">
                <div class="text-right">
                  <input type="button" data-toggle="modal" data-target="#modalAdicionar" class=" btn btn-round btn-success" value="Adicionar obra"
                  />
                </div>
                <table class="table" id='myTable'>
                  <thead>
                    <tr>
                      <th>
                        Título da obra
                      </th>
                      <th>
                        Autor/Diretor
                      </th>
                      <th>
                        Visualizar
                      </th>
                      <th>
                        Editar
                      </th>
                      <th>
                        Excluir
                      </th>
                    </tr>
                  </thead>
                  <tbody id="lista">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end: content -->


    <!-- modal visualizar -->

    <div class="modal fade" id="modalVisualizar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Visualizar Obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal" role="form">
                  <fieldset>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Título</label>
                      <div class="col-sm-10">
                        <input disabled="disabled" type="text" id="tituloView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Tipo</label>
                      <div class="col-sm-10">
                        <select disabled="disabled" class="form-control" id="tipoView">
                          <option>Livro</option>
                          <option>DVD</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Autor/Diretor</label>
                      <div class="col-sm-10">
                        <input disabled="disabled" type="text" id="autorView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Gênero</label>
                      <div class="col-sm-10">
                        <select disabled="disabled" class="form-control" id="generoView">
                          <option>Ação</option>
                          <option>Autoajuda</option>
                          <option>Biográfico</option>
                          <option>Científico</option>
                          <option>Conto</option>
                          <option>Crônicas</option>
                          <option>Épico</option>
                          <option>Fantasia</option>
                          <option>Ficção científica</option>
                          <option>Ficção histórica</option>
                          <option>Infantil</option>
                          <option>Novela</option>
                          <option>Poesia</option>
                          <option>Política</option>
                          <option>Romance</option>
                          <option>Terror</option>
                          <option>Outros</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">N° de Exemplares</label>
                      <div class="col-sm-10">
                        <input disabled="disabled" type="number" id="quantidadeView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Status</label>
                      <div class="col-sm-10">
                        <input disabled="disabled" type="text" id="statusView" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Descrição</label>
                      <div class="col-sm-10">
                        <input disabled="disabled" type="text" id="descricaoView" class="form-control">
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-round btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- fim modal visualizar -->


    <!-- modal editar -->

    <div class="modal fade" id="modalEditar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Editar Obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal" role="form">
                  <fieldset>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Título</label>
                      <div class="col-sm-10">
                        <input type="text" id="tituloEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Tipo</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="tipoEd">
                          <option>Livro</option>
                          <option>DVD</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Autor/Diretor</label>
                      <div class="col-sm-10">
                        <input type="text" id="autorEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Gênero</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="generoEd">
                          <option>Ação</option>
                          <option>Autoajuda</option>
                          <option>Biográfico</option>
                          <option>Científico</option>
                          <option>Conto</option>
                          <option>Crônicas</option>
                          <option>Épico</option>
                          <option>Fantasia</option>
                          <option>Ficção científica</option>
                          <option>Ficção histórica</option>
                          <option>Infantil</option>
                          <option>Novela</option>
                          <option>Poesia</option>
                          <option>Política</option>
                          <option>Romance</option>
                          <option>Terror</option>
                          <option>Outros</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">N° de Exemplares</label>
                      <div class="col-sm-10">
                        <input type="text" id="quantidadeEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Status</label>
                      <div class="col-sm-10">
                        <input disabled="disabled" type="text" id="statusEd" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Descrição</label>
                      <div class="col-sm-10">
                        <input type="text" id="descricaoEd" class="form-control">
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="botaoedit" class="btn btn-round btn-success" data-dismiss="modal" onclick="update()">Salvar alterações</button>
            <button type="button" class="btn btn-round btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- fim modal editar -->


    <!-- inicio modal excluir -->

    <div class="modal fade" id="modalExcluir" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Excluir obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Você realmente deseja excluir essa obra? Todos os exemplares serão excluídos também </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-round btn-danger">Excluir</button>
            <button type="button" class="btn btn-round btn-secondary" data-dismiss="modal">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- fim modal excluir -->

    <!-- inicio modal adicionar -->

    <div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Cadastrar Obra</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-12">
                <form class="form-horizontal" role="form">
                  <fieldset>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Título</label>
                      <div class="col-sm-10">
                        <input type="text" id="titulo" placeholder="Título da obra " class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Tipo</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="tipo">
                          <option>Livro</option>
                          <option>DVD</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Auto/Diretor</label>
                      <div class="col-sm-10">
                        <input type="text" id="autor" placeholder="Autor(es) ou Diretor(es)" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Gênero</label>
                      <div class="col-sm-10">
                        <select class="form-control" id="genero">
                          <option>Ação</option>
                          <option>Autoajuda</option>
                          <option>Biográfico</option>
                          <option>Científico</option>
                          <option>Conto</option>
                          <option>Crônicas</option>
                          <option>Épico</option>
                          <option>Fantasia</option>
                          <option>Ficção científica</option>
                          <option>Ficção histórica</option>
                          <option>Infantil</option>
                          <option>Novela</option>
                          <option>Poesia</option>
                          <option>Política</option>
                          <option>Romance</option>
                          <option>Terror</option>
                          <option>Outros</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">N° de Exemplares</label>
                      <div class="col-sm-10">
                        <input type="number" id="qtd" placeholder="Quantidade de Exemplares" class="form-control">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-2 control-label" for="textinput">Descrição</label>
                      <div class="col-sm-10">
                        <input type="text" id="descricao" placeholder="Descrição e/ou resumo" class="form-control">
                      </div>
                    </div>
                  </fieldset>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-round btn-success" data-dismiss="modal" onclick="create()">Adicionar obra</button>
            <button type="button" class="btn btn-round btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>



    <!-- fim modal adicionar -->




    <!-- start: Javascript -->
    <script src="asset/js/jquery.min.js"></script>
    <script src="asset/js/jquery.ui.min.js"></script>
    <script src="asset/js/bootstrap.min.js"></script>



    <!-- plugins -->
    <script src="asset/js/plugins/moment.min.js"></script>
    <script src="asset/js/plugins/jquery.datatables.min.js"></script>
    <script src="asset/js/plugins/datatables.bootstrap.min.js"></script>
    <script src="asset/js/plugins/jquery.nicescroll.js"></script>


    <!-- custom -->
    <script src="asset/js/main.js"></script>
    <script type="text/javascript"> 
      $(document).ready(function () {
        $('#myTable').DataTable({
          "oLanguage": {
            "sProcessing": "Processando...",
            "sLengthMenu": "Mostrar _MENU_ registros",
            "sZeroRecords": "Não foram encontrados resultados",
            "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
            "sInfoEmpty": "Mostrando de 0 até 0 de 0 registros",
            "sInfoFiltered": "",
            "sInfoPostFix": "",
            "sSearch": "Pesquisar:  ",
            "sUrl": "",
            "oPaginate": {
              "sFirst": "Primeiro",
              "sPrevious": "Anterior",
              "sNext": "Seguinte",
              "sLast": "Último"
            }
          }
        })
      });

    </script>

    <script>

      window.onload = () => {
        read();
      };

      function templateLista(id, titulo, autor, element = true) {
        return `
              ${element ? `<tr>` : ''}
              <td>${titulo}</td>
              <td>${autor}</td>
              <td><i class="view fa fa-eye" data-toggle="modal" data-target="#modalVisualizar" onclick="view(${id})"></i></td>
              <td><i class="update fa fa-edit" data-toggle="modal" data-target="#modalEditar" onclick="viewEdit(${id}); editId = ${id}"></i></td>
              <td><i class="delete fa fa-trash" data-toggle="modal" onclick="del(${id})"></i></td>
              ${element ? `</tr>` : ''}
        `;

      }

      function read() {
        lista.innerHTML = '';
        axios.post('http://localhost:8001/job/getAll')
          .then((response) => {
            response.data.data.forEach(element => {
              lista.innerHTML += templateLista(element.id_Obra, element.titulo, element.autor, element.descricao);
            });
          })
          .catch((error) => {
            console.log(error);
          });
      }

      function create() {
        var tipo;
        var genero = getIdGenero(document.getElementById('genero').value);

        if (document.getElementById('tipo').value == 'Livro') {
          tipo = 1;
        } else {
          tipo = 2;
        }

        axios.post('http://localhost:8001/job', { qtd: qtd.value, titulo: titulo.value, idGenero: genero, idTipo: tipo, autor: autor.value, descricao: descricao.value })
          .then(function (response) {
            read();
            console.log(response);
            qtd.value = '';
            titulo.value = '';
            autor.value = '';
            descricao.value = '';
          })
          .catch(function (error) {
            console.log(error);
          });
      }


      function del(id) {
        axios.delete(`http://localhost:8001/job/${id}`)
          .then(function (response) {
            if (response.status = 200) {
              alert(response.data.message)
              read();
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function viewEdit(id) {
        axios.get(`http://localhost:8001/job/${id}`)
          .then((response) => {
            response.data.data.forEach(element => {

              tituloEd.value = element.titulo;
              tipoSelected(element.tipo, 'tipoEd');
              autorEd.value = element.autor;
              quantidadeEd.value = element.qtd;
              descricaoEd.value = element.descricao;
              statusEd.value = element.status;
              console.log(element.status);
            });
          })
          .catch((error) => {
            console.log(error);
          });

      }

      function update() {
        console.log("entrei")
        let tipo = null
        if (tipoEd == 'Livro') {
          tipo = 1;
        } else {
          tipo = 2;
        }

        var status;
        var genero;

        axios.get(`http://localhost:8001/job/${editId}`)
          .then((response) => {
            response.data.data.forEach(element => {
              status = element.status;
              genero = getIdGenero(element.genero);
              console.log(genero);

              axios.put(`http://localhost:8001/job/${editId}`, {
                qtd: quantidadeEd.value,
                titulo: tituloEd.value,
                idGenero: genero,
                idTipo: tipo,
                autor: autorEd.value,
                descricao: descricaoEd.value
              })
                .then((response) => {
                  if (response.status = 200) {
                    read();
                  }
                })
                .catch(function (error) {
                  console.log(error);
                });
            });
          })
          .catch((error) => {
            console.log(error);
          });


      }

      function view(id) {
        axios.get(`http://localhost:8001/job/${id}`)
          .then((response) => {
            response.data.data.forEach(element => {

              tituloView.value = element.titulo;
              tipoSelected(element.tipo, 'tipoView');
              autorView.value = element.autor;
              quantidadeView.value = element.qtd;
              descricaoView.value = element.descricao;
              statusView.value = element.status;
            });
          })
          .catch((error) => {
            console.log(error);
          });

      }

      function tipoSelected(tipo, id) {
        document.getElementById(id).innerHTML = '';
        if (tipo == 'Livro') {
          document.getElementById(id).innerHTML +=
            `<option selected>Livro</option>
                <option>DVD</option>`
        } else {
          document.getElementById(id).innerHTML +=
            `<option>Livro</option>
                <option selected>DVD</option>`
        }
      }

      function getIdStatus(status) {
        if (status == 'Livre') {
          return 1;
        } else {
          return 2;
        }
      }

      function getTipoStatus(id) {
        if (id == 1) {
          return 'Livre';

        } else {
          return 'Emprestado';
        }
      }

      function getIdGenero(genero) {
        if (genero == 'Terror') {
          return '1';
        } else if (genero == 'Infantil') {
          return '2';
        } else if (genero == 'Ação') {
          return '3';
        } else if (genero == 'Autoajuda') {
          return '4';
        } else if (genero == 'Biográfico') {
          return '5';
        } else if (genero == 'Científico') {
          return '6';
        } else if (genero == 'Conto') {
          return '7';
        } else if (genero == 'Crônicas') {
          return '8';
        } else if (genero == 'Épico') {
          return '9';
        } else if (genero == 'Fantasia') {
          return '10';
        } else if (genero == 'Ficção científica') {
          return '11';
        } else if (genero == 'Ficção histórica') {
          return '12';
        } else if (genero == 'Poesia') {
          return '13';
        } else if (genero == 'Política') {
          return '14';
        } else if (genero == 'Romance') {
          return '15';
        } else if (genero == 'Novela') {
          return '16';
        } else if (genero == 'Novela') {
          return '17';
        }
      }

      function getTipoGenero(id) {
        if (id == 1) {
          return 'Terror';
        } else if (id == 2) {
          return 'Infantil';
        } else if (id == 3) {
          return 'Ação';
        } else if (id == 4) {
          return 'Autoajuda';
        } else if (id == 5) {
          return 'Biográfico';
        } else if (id == 6) {
          return 'Científico';
        } else if (id == 7) {
          return 'Conto';
        } else if (id == 8) {
          return 'Crônicas';
        } else if (id == 9) {
          return 'Épico';
        } else if (id == 10) {
          return 'Fantasia';
        } else if (id == 11) {
          return 'Ficção científica';
        } else if (id == 12) {
          return 'Ficção histórica';
        } else if (id == 13) {
          return 'Poesia';
        } else if (id == 14) {
          return 'Política';
        } else if (id == 15) {
          return 'Romance';
        } else if (id == 16) {
          return 'Novela';
        } else if (id == 17) {
          return 'Outros';
        }
      }
    </script>


    <!-- end: Javascript -->
</body>

</html>